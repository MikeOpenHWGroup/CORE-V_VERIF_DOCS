

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CV32E40P Simulation Testbench and Environment &mdash; CORE-V Verification Strategy  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CV64A Simulation Testbench and Environment" href="cv64_env.html" />
    <link rel="prev" title="PULP-Platform Simulation Verification" href="pulp_verif.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #DDDDDD" >
          

          
            <a href="index.html" class="icon icon-home"> CORE-V Verification Strategy
          

          
            
            <img src="_static/openhw-landscape.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="planning_requirements.html">Verification Planning and Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="pulp_verif.html">PULP-Platform Simulation Verification</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CV32E40P Simulation Testbench and Environment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#core-testbench">Core Testbench</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-cv32e40-uvm-verification-environment">The CV32E40* UVM Verification Environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#phase-1-environment">Phase 1 Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phase-2-environment">Phase 2 Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phase-2-development-strategy">Phase 2 Development Strategy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phase-3-environment">Phase 3 Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phase-3-development-strategy">Phase 3 Development Strategy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#file-structure-and-organization">File Structure and Organization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#naming-convention">Naming Convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="#directory-and-file-structure">Directory and File Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiling-the-environment">Compiling the Environment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cv64_env.html">CV64A Simulation Testbench and Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="sim_tests.html">Simulation Tests in the UVM Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="formal.html">CORE-V Formal Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="fpga.html">CORE-V FPGA Prototyping</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CORE-V Verification Strategy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>CV32E40P Simulation Testbench and Environment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/cv32_env.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cv32e40p-simulation-testbench-and-environment">
<span id="cv32-env"></span><h1>CV32E40P Simulation Testbench and Environment<a class="headerlink" href="#cv32e40p-simulation-testbench-and-environment" title="Permalink to this headline">¶</a></h1>
<p>As stated in the <a class="reference internal" href="pulp_verif.html#pulp-verif"><span class="std std-ref">PULP-Platform Simulation Verification</span></a> chapter (in the <a class="reference internal" href="pulp_verif.html#exec-summary"><span class="std std-ref">Executive Summary</span></a>),
CV32E40P verification will
follow a two-pronged approach using an updated RI5CY testbench,
hereafter referred to as the core testbench in parallel with the
development of a UVM environment. The UVM environment will be developed
in a step-wise fashion adding ever more capabilities, and will always
maintain the ability to run testcases and regressions.</p>
<p>The UVM environment will be based on the verification environment
developed for the Ibex core, using the Google random-instruction
generator for stimulus creation, the Imperas ISS for results prediction
and will also be able to run hand-coded code-segments (programs) such as
those developed by the RISC-V Compliance Task Group.</p>
<p>The end-goal is to have a single UVM-based verification environment
capable of complete CV32E40P and CV32E40 verification. This environment
will be rolled out in three phases as detailed below.</p>
<div class="section" id="core-testbench">
<h2>Core Testbench<a class="headerlink" href="#core-testbench" title="Permalink to this headline">¶</a></h2>
<p>The “core” testbench, shown in , on page , is essentially the RI5CY
testbench with some slight modifications. It is named after the
directory is it located in. This testbench has the ability to run the
directed, self-checking RISC-V Compliance and XPULP test programs
(mostly written in Assembler) used by RISC-V and will be used to update
the RISC-V Compliance and add XPULP Compliance testing for the CV32E40P.
These tests are the foundation of the <a class="reference external" href="https://github.com/openhwgroup/core-v-docs/tree/master/verif/CV32E40P/VerificationPlan/base_instruction_set">Base Instruction
Set</a>
and <a class="reference external" href="https://github.com/openhwgroup/core-v-docs/tree/master/verif/CV32E40P/VerificationPlan/xpulp_instruction_extensions">XPULP Instruction
Extensions</a>
captured in the CV32E40P verification plan.</p>
<p>The testbench has been (or will be) modified in the following ways:</p>
<ol class="arabic simple">
<li>Fix several Lint errors (Metrics dsim strictly enforces the IEEE-1800
type-checking rules).</li>
<li>Update parameters as appropriate.</li>
<li>Some RTL files were placed in the core director – these have been
moved out.</li>
<li>Support UVM error messages.</li>
<li>(TBD) Updates to the end-of-simulation flags in the Virtual
Peripherals.</li>
</ol>
</div>
<div class="section" id="the-cv32e40-uvm-verification-environment">
<h2>The CV32E40* UVM Verification Environment<a class="headerlink" href="#the-cv32e40-uvm-verification-environment" title="Permalink to this headline">¶</a></h2>
<p>This sub-section discusses the structure and development of the UVM
verification environment under development for CV32E40*. This
environment is intended to be able to verify the CV32E40P and CV32E40
devices with only minimal modification to the environment itself.</p>
<div class="section" id="phase-1-environment">
<h3>Phase 1 Environment<a class="headerlink" href="#phase-1-environment" title="Permalink to this headline">¶</a></h3>
<p>The goal of the phase 1 environment are to able to execute all of the
compliance tests from the RISC-V Foundation, PULP-Platform and OpenHW
Group, plus a set of manually written C and assembler testcases in a
minimal UVM environment. Essentially, it will have the same
functionality as the core testbench, but will all the overhead of the
UVM.</p>
<p>Recall from the structure of the core testbench. Swapping out the RI5CY
RTL model for the CV32E40P RTL model, and adding SystemVerilog
interfaces yields the testbench components for the phase 1 environment.
Rounding out the environment is a minimal UVM environment and UVM base
test. This is shown in Illustration 4.</p>
<div class="figure align-center" id="cv32-env-phase1">
<img alt="" src="_images/CV32E_VE_phase1.png" />
<p class="caption"><span class="caption-text">Illustration 4: Phase 1 CV32E40P UVM Environment</span></p>
</div>
<p>The testbench components of the phase 1 environment are the so-called
“DUT wrapper” (module uvmt_cv32_dut_wrap) which is a modification of
the riscv_wrapper in core testbench, and the “testbench” (module
uvmt_cv32_tb) which is a replacement of the tb_top module from the
core testbench. This structure provides the UVM environment with access
to all of the CV32E40P top-level control and status ports via
SystemVerilog interfaces. Note that for phase 1, most of the control
inputs are static, just as they are in the core testbench. The phase 2
environment will have dedicated UVM agents for each of the interfaces
shown in , allowing testcases to control these interfaces using UVM test
sequences.</p>
<p>The phase 1 environment will also control the function of the riscv-gcc
toolchain directly as part of the UVM run-flow, simplifying the
Makefiles used to control compilation and execution of testcases.</p>
</div>
<div class="section" id="phase-2-environment">
<h3>Phase 2 Environment<a class="headerlink" href="#phase-2-environment" title="Permalink to this headline">¶</a></h3>
<p>The phase two environment is shown in Illustration 5. Phase 2 introduces the <a class="reference external" href="https://github.com/google/riscv-dv">Google
Random Instruction Generator</a> and
the <a class="reference external" href="http://www.imperas.com/articles/imperas-empowers-riscv-community-with-riscvovpsim">Imperas
ISS</a>
as a stand-alone components. The most significant capabilities of the
phase 2 environment are:</p>
<ul class="simple">
<li>Ability to use SystemVerilog class constraints to automatically
generate testcases.</li>
<li>Results checking is built into the environment, so that testcases do
not need to determine and check their own pass/fail criteria.</li>
<li>Simple UVM Agents for both the Interrupt and Debug interfaces. ToDo:
show this in the Illustration.</li>
<li>Ability to run any/all testcases developed for the Phase 1
environment.</li>
<li>Support either of the CV32E40P or CV32E40 with only minor
modifications.</li>
</ul>
<div class="figure align-center" id="cv32-ve-phase2">
<img alt="" src="_images/CV32E_VE_phase2.png" />
<p class="caption"><span class="caption-text">Illustration 5: Phase 2 Verification Environment for CV32E</span></p>
</div>
<p>As shown in the Illustration, the environment is not a single entity.
Rather, it is a collection of disjoint components, held together by
script-ware to make it appear as a single environment. When the user
invokes a command to run a testcase, for example, make
xrun-firmware <a class="footnote-reference" href="#id2" id="id1">[10]</a>, a set of scripts and/or Makefile rules are
invoked to compile the environment and test(s), run the simulation(s)
and check results. The illustration shows the most
significant of these:</p>
<ul class="simple">
<li><strong>make gen</strong>: this is an optional step for those tests that run
stimulus generated by the Google random instruction generator. Tests
that use manually generated or externally sourced tests will skip
this test. The generator produces an assembly-language file which is
used as input to <em>asm2hex</em>.</li>
<li><strong>make asm2hex</strong>: this step invokes the SDK (riscv-gcc
tool-chain) to compile/assemble/link the input program into an ELF
file. The input program is either from the <em>make gen</em> step
or a previously written assembler program. The ELF is translated
to a hexfile, in verilog “memh” format, that can be loaded into a
SystemVerilog memory.</li>
<li><strong>make sv-sim</strong>: this step runs a SystemVerilog simulator that
compiles the CV32E and its associated testbench. As with the RI5CY
testbench, the asm2hex generated hexfile is loaded into Instruction
memory and the core starts to execute the code it finds there.
Results are written to an <em>actual</em> results output file.</li>
<li><strong>make iss-sim</strong>: this step compiles and runs the
Instruction Set Simulator, using the same ELF
produced in the <em>make asm2hex step</em>. The ISS thereby runs
the same program as the RTL model of the core and produces an
<em>expected</em> result output file.</li>
<li><strong>make cmp</strong>: here a simple compare script is run that
matches the actual results produced by the RTL with the expected
results produced by the ISS. Any mismatch results in a testcase
failure.</li>
</ul>
</div>
<div class="section" id="phase-2-development-strategy">
<h3>Phase 2 Development Strategy<a class="headerlink" href="#phase-2-development-strategy" title="Permalink to this headline">¶</a></h3>
<p>The disjoint-component nature of the phase two environment simplifies
its development, as almost any component of the environment can be
developed, unit-tested and deployed separately, without a significant
impact on the other components or on the phase one environment. In
addition, the Ibex environment provides a working example for much of
the phase two work.</p>
<p>The first step will be to introduce the random-instruction generator
into the script-ware. This is seen as a relatively simple task as the
generator has been developed as a stand-alone UVM component and has
previously been vetted by OpenHW. Once the generator is integrated,
user’s of the environment will have the ability to run existing or new
testcases for the phase one environment, as well has run generated
programs on the RTL. The programs generated by the Google
random-instruction generator are not self-checking, so tests run with
the generator will not produce a useful pass/fail indication, although
they may be used to measure coverage.</p>
<p>In order to get a self-checking environment, the ISS needs to be
integrated into the flow. This is explicitly supported by the Google
generator, so this is seen as low-risk work. An open issue is to extract
execution trace information both the RTL simulation and ISS simulation
in such a way as to make the comparison script simple. Ideally, the
comparison script would be implemented using <strong>*diff*</strong>. This is a
significant ToDo.</p>
</div>
<div class="section" id="phase-3-environment">
<h3>Phase 3 Environment<a class="headerlink" href="#phase-3-environment" title="Permalink to this headline">¶</a></h3>
<p>ToDo</p>
</div>
<div class="section" id="phase-3-development-strategy">
<h3>Phase 3 Development Strategy<a class="headerlink" href="#phase-3-development-strategy" title="Permalink to this headline">¶</a></h3>
<p>ToDo</p>
</div>
</div>
<div class="section" id="file-structure-and-organization">
<h2>File Structure and Organization<a class="headerlink" href="#file-structure-and-organization" title="Permalink to this headline">¶</a></h2>
<p>ToDo</p>
<div class="section" id="naming-convention">
<h3>Naming Convention<a class="headerlink" href="#naming-convention" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="directory-and-file-structure">
<h3>Directory and File Structure<a class="headerlink" href="#directory-and-file-structure" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="compiling-the-environment">
<h3>Compiling the Environment<a class="headerlink" href="#compiling-the-environment" title="Permalink to this headline">¶</a></h3>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[10]</a></td><td>See the README at
<a class="reference external" href="https://github.com/openhwgroup/core-v-verif/tree/master/cv32/tests/core">https://github.com/openhwgroup/core-v-verif/tree/master/cv32/tests/core</a>
to see what this does. Note that the User Manual for the Verification
Environment, which explains how to write and run testcases, will be
maintained there, not in the
<a class="reference external" href="https://github.com/openhwgroup/core-v-docs/tree/master/verif">core-v-docs</a>project
which is home for this document.</td></tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cv64_env.html" class="btn btn-neutral float-right" title="CV64A Simulation Testbench and Environment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pulp_verif.html" class="btn btn-neutral float-left" title="PULP-Platform Simulation Verification" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, OpenHW Group

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>